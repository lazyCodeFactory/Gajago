<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminLogMapper">

	<insert id="insertAccLogSeq" parameterType="hashmap" useGeneratedKeys="true" keyProperty="SEQ" >
		INSERT INTO seq_master 
		( TABLE_ID
		 , REGIST_DT
		 , SEQ
		) VALUES (
		 'ACC_LOG'
		 , DATE_FORMAT(NOW(), '%Y%m%d')
		 , 1
		 ) ON DUPLICATE KEY UPDATE SEQ = SEQ + 1
		<selectKey resultType="int" keyProperty="SEQ" order="AFTER"> 
			SELECT SEQ FROM seq_master WHERE TABLE_ID = 'ACC_LOG' AND REGIST_DT = DATE_FORMAT(NOW(), '%Y%m%d'); 
		</selectKey>
	</insert>

	<insert id="insertAmdinLog" parameterType="hashmap">
		INSERT INTO acc_dt /*adminLogMapper.insertAmdinLog*/
		(
		 ACC_DT        <!-- 등록유효일자 -->
		 , ACC_SEQ        <!-- 자료일련번호 -->
		 , ADMIN_ID         <!-- IP주소 -->
		 , WAS_SVR_IP_ADD <!-- WAS서버IP주소 -->
		 , UR_ACC_ID      <!-- 사용자계정ID -->
		 , INFL_PH_URL    <!-- 유입경로URL -->
		 , WO_RCD_CN      <!-- 전체레코드내용 -->
		 , RMK_CN         <!-- 비고내용 -->
		 , FST_CRT_USID   <!-- 등록회원ID -->
		 , FST_CRT_DTTI   <!-- 등록일시 -->
		 , LT_CH_USID     <!-- 수정회원ID -->
		 , LT_CH_DTTI     <!-- 수정일시 -->
		 )VALUES (
		TO_CHAR(SYSDATE, 'YYYYMMDD')
		, (SELECT NVL(MAX(MTR_SEQ)+1, 1) FROM ML_TB_MGR_CNNT_HIST WHERE RG_VALD
		= TO_CHAR(SYSDATE, 'YYYYMMDD'))
		, <![CDATA[#{IP_ADD}]]>
		, <![CDATA[#{WAS_SVR_IP_ADD}]]>
		, <![CDATA[#{UR_ACC_ID}]]>
		, <![CDATA[#{INFL_PH_URL}]]>
		, <![CDATA[#{WO_RCD_CN}]]>
		, <![CDATA[#{RMK_CN}]]>
		, #{UR_ACC_ID}
		, SYSDATE
		, #{UR_ACC_ID}
		, SYSDATE
		)
	</insert>
	
	<!-- METALOG 등록 -->
	<insert id="insertMetaLog" parameterType="hashmap">
		INSERT INTO acc_log /*adminLogMapper.insertMetaLog*/
		(
		 ACC_DT							<!-- 기준일자 -->
		 , ACC_SEQ						<!-- ACC_SEQ -->
		 , SITE_PREFIX 					<!-- 접근사이트 -->
		 , ADMIN_ID						<!-- 사용자계정ID -->
		 , REFER_URL					<!-- 유입경로URL -->
		 , URL
		 , PAR_POST						<!-- POST 파라메터 -->
		 , PAR_GET						<!-- GET 파라메커 -->
		 , IP							<!-- IP -->
		 , REGIST_DT					<!-- 등록일시 -->
		 , METHOD						<!-- 접근 METHOD -->
		 , WAS_IP						<!-- WAS IP -->
		 , HEADER
		)VALUES (
		 DATE_FORMAT(NOW(), '%Y%m%d')
		, #{SEQ}
		, <![CDATA[#{SITE_PREFIX}]]>
		, <![CDATA[#{UR_ACC_ID}]]>
		, <![CDATA[#{INIT_REFERER}]]>
		, <![CDATA[#{INFL_PH_URL}]]>
		, <![CDATA[#{INIT_JSON_PARAM}]]>
		, <![CDATA[#{QUERY_STRING}]]>
		, <![CDATA[#{IP_ADD}]]>
		, NOW()
		, <![CDATA[#{METHOD}]]>
		, <![CDATA[#{WAS_SVR_IP_ADD}]]>
		, <![CDATA[#{RMK_CN}]]>
		)
</insert>
</mapper>