package com.ssocio.sharing.controller.admin;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartHttpServletRequest;
import org.springframework.web.servlet.ModelAndView;

import com.ssocio.sharing.cmmn.util.CmmnCnst;
import com.ssocio.sharing.cmmn.util.LoggerUtil;
import com.ssocio.sharing.cmmn.util.StringUtil;
import com.ssocio.sharing.service.admin.AdminOrderService;
import com.ssocio.sharing.vo.admin.AdminSession;
import com.ssocio.sharing.vo.seller.SellerSession;

/**
 * <pre>
 * 주문관리
 * 판매 상품 주문 관리
 * @author S.B.LEE
 * @version
 * @since 2015. 7. 10. 오후 5:34:59
 * @see
 * @History
 * Date			|	author	| 변경 내용
 * 2015. 7. 10.	|	S.B.LEE	|신규
 * @비고
 * </pre>
 */
@Controller
public class AdminOrderController extends AdminReferController {
	// --------------------------------------------------------------------------
	// # Log 설정
	// --------------------------------------------------------------------------
	private static final Logger logger = LoggerFactory.getLogger(AdminOrderController.class);
	
	// --------------------------------------------------------------------------
	// # Service 설정
	// --------------------------------------------------------------------------
	@Autowired
	private AdminOrderService adminOrderService;
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 판매 주문 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 05
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListSaleOrd.do")
	public ModelAndView selectListSaleOrder(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT SALE PROD ORDER LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);

		try {
			mav.addObject("list", adminOrderService.selectListSaleOrd(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectListSaleOrd");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 excel 다운로드
	 * 판매 주문 excel 다운로드
	 * @param request
	 * @param response
	 * @param inParam
	 * @param seltArray
	 * @param ordArray
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 05
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListSaleOrdExcel.do")
	public ModelAndView selectListSaleOrdExcel(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT SALE PROD ORDER LIST EXCL DOWNLOAD");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		mav.setViewName("excelDownloadView2");
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", getDisposition("판매주문조회_"+today+".xls", check_browser(request)));
			String SheetName = "판매 주문 조회";
			
			List<String> excelTitle = new ArrayList<String>();
			
			excelTitle.add("주문번호");
			excelTitle.add("주문일시");
			excelTitle.add("주문자명(ID)");
			excelTitle.add("휴대폰번호");
			excelTitle.add("판매자명(ID)");
			excelTitle.add("상품코드");
			excelTitle.add("주문상태");
			excelTitle.add("상품명");
			excelTitle.add("옵션");
			excelTitle.add("판매가");
			excelTitle.add("옵션가");
			excelTitle.add("수량");
			excelTitle.add("상품금액");
			excelTitle.add("배송비");
			excelTitle.add("쿠폰할인");
			excelTitle.add("주문금액");
			excelTitle.add("포인트사용");
			excelTitle.add("결제금액");
			excelTitle.add("결제수단");
			excelTitle.add("카드사");
			excelTitle.add("이름");
			excelTitle.add("연락처");
			excelTitle.add("안심번호");
			excelTitle.add("우편번호");
			excelTitle.add("도로명 주소(기본주소+상세주소)");
			excelTitle.add("지번 주소(기본주소+상세주소)");
			excelTitle.add("배송메모");
			excelTitle.add("택배사");
			excelTitle.add("송장번호");
			excelTitle.add("배송일자");
			excelTitle.add("도착일자");
			
	
			List<String> CellName = new ArrayList<String>();
			CellName.add("ORD_CD");
			CellName.add("ORD_REG_DATE");
			CellName.add("ORDER_INFO");
			CellName.add("ORD_HP");
			CellName.add("SELLER_INFO");
			CellName.add("PROD_CODE");
			CellName.add("PROC_STAT_CD_NAME");
			CellName.add("PROD_NM");
			CellName.add("OPT_NM");
			CellName.add("PROD_PRICE");
			CellName.add("OPT_PRCE");
			CellName.add("ORD_QTY");
			CellName.add("PROD_PRCE");
			CellName.add("DLV_PRCE");
			CellName.add("CPN_USE_AMT");
			CellName.add("ORDER_PRICE");
			CellName.add("POINT_USE_AMT");
			CellName.add("REAL_SELT_AMT");
			CellName.add("SELT_GB_NAME");
			CellName.add("CARD_COMP_NM");
			CellName.add("RCV_NM");
			CellName.add("RCV_TEL");
			CellName.add("SECU_NO");
			CellName.add("ZIP_CD");
			CellName.add("JUSO_JIBEN");
			CellName.add("JUSO_DORO");
			CellName.add("DLV_MSG");
			CellName.add("DLV_CMP_CD");
			CellName.add("INVC_NO");
			CellName.add("DLV_REGIST_DT");
			CellName.add("DLV_END_DT");
			
			List<String> sizeList = new ArrayList<String>();
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("50");
			sizeList.add("50");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
	
			mav.addObject("fileName", "판매주문조회_"+today+".xls");
			mav.addObject("sizeList", sizeList);
			mav.addObject("SheetName", SheetName);
			mav.addObject("excelTitle", excelTitle);
			mav.addObject("CellName", CellName);
			
			mav.addObject("excelList", adminOrderService.selectListSaleOrdExcel(inParam));
			mav.addObject("param", inParam);

		} catch (Exception e) {e.printStackTrace();}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문상세내용 조회
	 * 주문상세내용을 조회합니다.
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 05
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectSaleOrdDtl.do")
	public ModelAndView selectSaleOrdDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT ORDER DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			mav.addObject("list", adminOrderService.selectSaleOrdDtl(inParam));
			mav.setViewName("admin/order/selectSaleOrdDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문상세내용 조회
	 * 배송지 정보를 수정 합니다.
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 09
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateDlvOrderDtl.do")
	public ModelAndView updateDlvOrderDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT updateDvlOrderDtl START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			System.out.println(inParam);
			mav.addObject("list", adminOrderService.insertOrdDlv(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문메모 저장
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 09
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateAdminMemo.do")
	public ModelAndView updateAdminMemo(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateAdminMemo START☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView("jsonView");
		try {
			// 판매,판매교환신청,나눔수락
			adminOrderService.updateAdminMemo(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 취소
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 09
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/cancelSaleOrderState.do")
	public ModelAndView cancelSharOrderState(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("ORDER SALE CANCEL");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		String mAdmId = session.getADM_ID();
		String mAdmNm = session.getADM_NM();
		inParam.put("ADM_ID", mAdmId);	
		inParam.put("ADM_NM", mAdmNm);
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		Map<String, Object> cancelGroup = adminOrderService.selectSaleAdminOrderCancelGroupInfo(inParam);
		if(Integer.parseInt(cancelGroup.get("CT").toString()) == 1){
			//단일 상품 취소
			inParam.put("BUYER_SEQ",Integer.parseInt(cancelGroup.get("MBER_SEQ").toString()));
			inParam.put("POINT_USE_AMT",Integer.parseInt(cancelGroup.get("POINT_USE_AMT").toString()));
			inParam.put("REAL_SELT_AMT",cancelGroup.get("REAL_SELT_AMT").toString());
			Map<String, Object> result = adminOrderService.cancelSaleAdminOrderOneItem(inParam);
			if(result.get("RESULT").equals("OK")){
				mav.addObject("result", 1);
				mav.addObject("msg", "성공");
			}else if(result.get("RESULT").equals("DB")){
				mav.addObject("result", 0);
				mav.addObject("msg", "DB UPDATE FAIL");
			}else if(result.get("RESULT").equals("API")){
				mav.addObject("result", 0);
				mav.addObject("msg", "API FAIL");
			}else{
				mav.addObject("result", 0);
				mav.addObject("msg", "ETC FAIL");
			}
		}else{
			//복합 상품 취소
			Map<String, Object> multiResult = new HashMap<String, Object>();
			String seltGbCd = (String)inParam.get("SELT_GB_CD");	//결재 구분자
			if(seltGbCd.equals("0")){
				multiResult = adminOrderService.cancelSaleAdminOrderMultiItemZero(inParam);
			}else{
				multiResult = adminOrderService.cancelSaleAdminOrderMultiItem(inParam);
			}
			if(multiResult.get("RESULT").equals("OK")){
				mav.addObject("result", 1);
				mav.addObject("msg", "성공");
			}else if(multiResult.get("RESULT").equals("DB")){
				mav.addObject("result", 0);
				mav.addObject("msg", "DB UPDATE FAIL");
			}else if(multiResult.get("RESULT").equals("API")){
				mav.addObject("result", 0);
				mav.addObject("msg", "API FAIL");
			}else{
				mav.addObject("result", 0);
				mav.addObject("msg", "ETC FAIL");
			}
		}
		
		mav.setViewName("jsonView");
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 배송 조회 팝업
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 05
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/openDlvStatPopup.do")
	public ModelAndView openDlvStatPopup(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("list", adminOrderService.selectDvlStateInfo(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/dlvStatePopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 운송장 번호 입력 팝업
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 12. 02
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/dlvInfoInsertPopup.do")
	public ModelAndView dlvInfoInsertPopup(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/dlvInfoInsertPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 운송장 번호, 배송완료 시간 업데이트  팝업
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 12. 04
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/dlvInfoModifyPopup.do")
	public ModelAndView dlvInfoModifyPopup(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/dlvInfoModifyPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 운송장 번호, 배송완료 시간 업데이트  처리
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 12. 07
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/modifyDlvTime.do")
	public ModelAndView modifyDlvTime(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN update DLV TIME START☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView("jsonView");
		try {
			// 배송정보 업데이트 처리
			mav.addObject("result",adminOrderService.updateDlvTime(inParam));
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("result", 0);
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 취소사유 팝업
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 12. 01
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/cancelReasonPopup.do")
	public ModelAndView cancelReasonPopup(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.setViewName("admin/order/cancelReasonPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 배송 업체 URL 링크 팝업
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 10
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectDlvCompanyURL.do")
	public ModelAndView selectDlvCompanyURL(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		ModelAndView mav = new ModelAndView("jsonView");
		try {
			mav.addObject("result", adminOrderService.selectDlvCompanyURL(inParam));
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("result", "");
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 배송 업체 운송장 정보 입력
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 10
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/insertDlvInvcNumber.do")
	public ModelAndView insertDlvInvcNumber(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		ModelAndView mav = new ModelAndView("jsonView");
		int result = 0;
		try {
			result = adminOrderService.insertDlvInvcNumber(inParam);
			mav.addObject("result", result);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("result", 0);
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 판매 반품신청 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 10
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListTakeBackOrd.do")
	public ModelAndView selectListTakeBackOrd(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT SALE TAKE BACK PROD ORDER LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
			mav.addObject("list", adminOrderService.selectListTakeBackOrd(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectListTakeBackOrd");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 판매 반품상세 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 10
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectTakeBackOrdDtl.do")
	public ModelAndView selectTakeBackOrdDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT TAKE BACK ORDER DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("params", inParam);
			mav.addObject("list", adminOrderService.selectTakeBackOrdDtl(inParam));
			mav.setViewName("admin/order/selectTakeBackOrdDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 반품 완료 결제 처리
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 11
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/takeBackOrderState.do")
	public ModelAndView takeBackOrderState(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("TAKEBACK ORDER PROCESSING");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		String mAdmId = session.getADM_ID();
		String mAdmNm = session.getADM_NM();
		inParam.put("ADM_ID", mAdmId);	
		inParam.put("ADM_NM", mAdmNm);
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		Map<String, Object> cancelGroup = adminOrderService.selectSaleAdminOrderCancelGroupInfo(inParam);
		if(Integer.parseInt(cancelGroup.get("CT").toString()) == 1){
			//단일 상품 반품 처리
			inParam.put("BUYER_SEQ",Integer.parseInt(cancelGroup.get("MBER_SEQ").toString()));
			inParam.put("POINT_USE_AMT",Integer.parseInt(cancelGroup.get("POINT_USE_AMT").toString()));
			inParam.put("REAL_SELT_AMT",cancelGroup.get("REAL_SELT_AMT").toString());
			Map<String, Object> result = adminOrderService.takeBackOrderOneItem(inParam);
			if(result.get("RESULT").equals("OK")){
				mav.addObject("result", 1);
				mav.addObject("msg", "성공");
			}else if(result.get("RESULT").equals("DB")){
				mav.addObject("result", 0);
				mav.addObject("msg", "DB UPDATE FAIL");
			}else if(result.get("RESULT").equals("API")){
				mav.addObject("result", 0);
				mav.addObject("msg", "API FAIL");
			}else{
				mav.addObject("result", 0);
				mav.addObject("msg", "ETC FAIL");
			}
		}else{
			//복합 상품 반품 처리
			Map<String, Object> multiResult = new HashMap<String, Object>();
			String seltGbCd = (String)inParam.get("SELT_GB_CD");	//결재 구분자
			if(seltGbCd.equals("0")){
				multiResult = adminOrderService.cancelSaleAdminOrderMultiItemZero(inParam);
			}else{
				multiResult = adminOrderService.takeBackOrderMultiItem(inParam);
			}
			if(multiResult.get("RESULT").equals("OK")){
				mav.addObject("result", 1);
				mav.addObject("msg", "성공");
			}else if(multiResult.get("RESULT").equals("DB")){
				mav.addObject("result", 0);
				mav.addObject("msg", "DB UPDATE FAIL");
			}else if(multiResult.get("RESULT").equals("API")){
				mav.addObject("result", 0);
				mav.addObject("msg", "API FAIL");
			}else{
				mav.addObject("result", 0);
				mav.addObject("msg", "ETC FAIL");
			}
		}
		
		mav.setViewName("jsonView");
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 교환신청 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 11
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListExcOrd.do")
	public ModelAndView selectListExcOrd(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT SALE CHANGE PROD ORDER LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
			mav.addObject("params", inParam);
			mav.addObject("list", adminOrderService.selectListExcOrd(inParam));
			mav.setViewName("admin/order/selectListExcOrd");
		} catch (Exception e) {
			e.printStackTrace();
		}

		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 교환신청 상세
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 11
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectExcOrdDtl.do")
	public ModelAndView selectExcOrdDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT ORDER DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("params", inParam);
			mav.addObject("list", adminOrderService.selectExcOrdDtl(inParam));
			mav.setViewName("admin/order/selectExcOrdDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 판매 주문취소 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 11
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListCnclOrd.do")
	public ModelAndView selectListCnclOrd(	HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception {
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("ORDER CANCEL LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);

		try {
			mav.addObject("params", inParam);
			mav.addObject("list", adminOrderService.selectListCnclOrd(inParam));
			mav.setViewName("admin/order/selectListCnclOrd");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리 
	 * 판매 주문취소 상세
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 11
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectCnclDtl.do")
	public ModelAndView selectCnclDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception {
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT CNCL DTL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);

		try {
			mav.addObject("params", inParam);
			mav.addObject("list", adminOrderService.selectCnclDtl(inParam));
			mav.setViewName("admin/order/selectCnclDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 배송완료 상태 변경
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 28
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateDlvClose.do")
	public ModelAndView updateDlvClose(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT UPDATE ORDER STATE START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			mav.addObject("result", adminOrderService.updateDlvClose(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리
	 * 판매 교환 excel 다운로드
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 18
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListSaleOrdExcExcel.do")
	public ModelAndView selectListSaleOrdExcExcel(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		mav.setViewName("excelDownloadView2");
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", getDisposition("판매교환신청조회_"+today+".xls", check_browser(request)));
			String SheetName = "판매 교환신청 조회";
			
			List<String> excelTitle = new ArrayList<String>();
			
			excelTitle.add("교환신청일시");
			excelTitle.add("교환사유");
			excelTitle.add("주문번호");
			excelTitle.add("주문일시");
			excelTitle.add("주문자명(ID)");
			excelTitle.add("휴대폰번호");
			excelTitle.add("판매자명(ID)");
			excelTitle.add("상품코드");
			excelTitle.add("주문상태");
			excelTitle.add("상품명");
			excelTitle.add("옵션");
			excelTitle.add("판매가");
			excelTitle.add("옵션가");
			excelTitle.add("수량");
			excelTitle.add("상품금액");
			excelTitle.add("배송비");
			excelTitle.add("쿠폰할인");
			excelTitle.add("주문금액");
			excelTitle.add("포인트사용");
			excelTitle.add("결제금액");
			excelTitle.add("결제수단");
			excelTitle.add("카드사");
			excelTitle.add("이름");
			excelTitle.add("연락처");
			excelTitle.add("우편번호");
			excelTitle.add("도로명 주소(기본주소+상세주소)");
			excelTitle.add("지번 주소(기본주소+상세주소)");
			excelTitle.add("배송메모");
			excelTitle.add("택배사");
			excelTitle.add("송장번호");
			excelTitle.add("배송일자");
			excelTitle.add("도착일자");
	
			List<String> CellName = new ArrayList<String>();
			CellName.add("REQUEST_DT");
			CellName.add("CHG_REASON");
			CellName.add("ORD_CD");
			CellName.add("ORD_REG_DATE");
			CellName.add("ORDER_INFO");
			CellName.add("ORD_HP");
			CellName.add("SELLER_INFO");
			CellName.add("PROD_CODE");
			CellName.add("PROC_STAT_CD_NAME");
			CellName.add("PROD_NM");
			CellName.add("OPT_NM");
			CellName.add("PROD_PRICE");
			CellName.add("OPT_PRCE");
			CellName.add("ORD_QTY");
			CellName.add("PROD_PRCE");
			CellName.add("DLV_PRCE");
			CellName.add("CPN_USE_AMT");
			CellName.add("ORDER_PRICE");
			CellName.add("POINT_USE_AMT");
			CellName.add("REAL_SELT_AMT");
			CellName.add("SELT_GB_NAME");
			CellName.add("CARD_COMP_NM");
			CellName.add("RCV_NM");
			CellName.add("RCV_TEL");
			CellName.add("ZIP_CD");
			CellName.add("JUSO_JIBEN");
			CellName.add("JUSO_DORO");
			CellName.add("DLV_MSG");
			CellName.add("DLV_CMP_CD");
			CellName.add("INVC_NO");
			CellName.add("DLV_REGIST_DT");
			CellName.add("DLV_END_DT");
			
			List<String> sizeList = new ArrayList<String>();
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("50");
			sizeList.add("50");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
	
			mav.addObject("fileName", "판매교환신청조회_"+today+".xls");
			mav.addObject("sizeList", sizeList);
			mav.addObject("SheetName", SheetName);
			mav.addObject("excelTitle", excelTitle);
			mav.addObject("CellName", CellName);
			
			mav.addObject("excelList", adminOrderService.selectListSaleOrdExcExcel(inParam));
			mav.addObject("param", inParam);

		} catch (Exception e) {e.printStackTrace();}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리
	 * 판매 반품 excel 다운로드
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 18
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListSaleOrdTakeBackExcel.do")
	public ModelAndView selectListSaleOrdTakeBackExcel(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		mav.setViewName("excelDownloadView2");
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", getDisposition("판매반품신청조회_"+today+".xls", check_browser(request)));
			String SheetName = "판매 반품신청 조회";
			
			List<String> excelTitle = new ArrayList<String>();
			
			excelTitle.add("반품신청일시");
			excelTitle.add("반품사유");
			excelTitle.add("주문번호");
			excelTitle.add("주문일시");
			excelTitle.add("주문자명(ID)");
			excelTitle.add("휴대폰번호");
			excelTitle.add("판매자명(ID)");
			excelTitle.add("상품코드");
			excelTitle.add("주문상태");
			excelTitle.add("상품명");
			excelTitle.add("옵션");
			excelTitle.add("판매가");
			excelTitle.add("옵션가");
			excelTitle.add("수량");
			excelTitle.add("상품금액");
			excelTitle.add("배송비");
			excelTitle.add("쿠폰할인");
			excelTitle.add("주문금액");
			excelTitle.add("포인트사용");
			excelTitle.add("결제금액");
			excelTitle.add("결제수단");
			excelTitle.add("카드사");
			excelTitle.add("이름");
			excelTitle.add("연락처");
			excelTitle.add("우편번호");
			excelTitle.add("도로명 주소(기본주소+상세주소)");
			excelTitle.add("지번 주소(기본주소+상세주소)");
			excelTitle.add("배송메모");
			excelTitle.add("택배사");
			excelTitle.add("송장번호");
			excelTitle.add("배송일자");
			excelTitle.add("도착일자");
	
			List<String> CellName = new ArrayList<String>();
			CellName.add("REQUEST_DT");
			CellName.add("CHG_REASON");
			CellName.add("ORD_CD");
			CellName.add("ORD_REG_DATE");
			CellName.add("ORDER_INFO");
			CellName.add("ORD_HP");
			CellName.add("SELLER_INFO");
			CellName.add("PROD_CODE");
			CellName.add("PROC_STAT_CD_NAME");
			CellName.add("PROD_NM");
			CellName.add("OPT_NM");
			CellName.add("PROD_PRICE");
			CellName.add("OPT_PRCE");
			CellName.add("ORD_QTY");
			CellName.add("PROD_PRCE");
			CellName.add("DLV_PRCE");
			CellName.add("CPN_USE_AMT");
			CellName.add("ORDER_PRICE");
			CellName.add("POINT_USE_AMT");
			CellName.add("REAL_SELT_AMT");
			CellName.add("SELT_GB_NAME");
			CellName.add("CARD_COMP_NM");
			CellName.add("RCV_NM");
			CellName.add("RCV_TEL");
			CellName.add("ZIP_CD");
			CellName.add("JUSO_JIBEN");
			CellName.add("JUSO_DORO");
			CellName.add("DLV_MSG");
			CellName.add("DLV_CMP_CD");
			CellName.add("INVC_NO");
			CellName.add("DLV_REGIST_DT");
			CellName.add("DLV_END_DT");
			
			List<String> sizeList = new ArrayList<String>();
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("50");
			sizeList.add("50");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
	
			mav.addObject("fileName", "판매교환신청조회_"+today+".xls");
			mav.addObject("sizeList", sizeList);
			mav.addObject("SheetName", SheetName);
			mav.addObject("excelTitle", excelTitle);
			mav.addObject("CellName", CellName);
			
			mav.addObject("excelList", adminOrderService.selectListSaleOrdTakeBackExcel(inParam));
			mav.addObject("param", inParam);

		} catch (Exception e) {e.printStackTrace();}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 관리 > 판매주문관리
	 * 판매 취소 excel 다운로드
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 11. 18
	 * @author Y.S.KIM
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListSaleOrdCancelExcel.do")
	public ModelAndView selectListSaleOrdCancelExcel(HttpServletRequest request, HttpServletResponse response , @RequestParam Map<String, Object> inParam) throws Exception{
		LoggerUtil.writeMap(inParam);
		ModelAndView mav = new ModelAndView();
		mav.setViewName("excelDownloadView2");
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", getDisposition("판매주문취소조회_"+today+".xls", check_browser(request)));
			String SheetName = "판매 주문취소 조회";
			
			List<String> excelTitle = new ArrayList<String>();
			
			excelTitle.add("취소신청일시");
			excelTitle.add("주문취소사유");
			excelTitle.add("주문번호");
			excelTitle.add("주문일시");
			excelTitle.add("주문자명(ID)");
			excelTitle.add("휴대폰번호");
			excelTitle.add("판매자명(ID)");
			excelTitle.add("상품코드");
			excelTitle.add("주문상태");
			excelTitle.add("상품명");
			excelTitle.add("옵션");
			excelTitle.add("판매가");
			excelTitle.add("옵션가");
			excelTitle.add("수량");
			excelTitle.add("상품금액");
			excelTitle.add("배송비");
			excelTitle.add("쿠폰할인");
			excelTitle.add("주문금액");
			excelTitle.add("포인트사용");
			excelTitle.add("결제금액");
			excelTitle.add("결제수단");
			excelTitle.add("카드사");
			excelTitle.add("이름");
			excelTitle.add("연락처");
			excelTitle.add("우편번호");
			excelTitle.add("도로명 주소(기본주소+상세주소)");
			excelTitle.add("지번 주소(기본주소+상세주소)");
			excelTitle.add("배송메모");
			excelTitle.add("택배사");
			excelTitle.add("송장번호");
			excelTitle.add("배송일자");
			excelTitle.add("도착일자");
			
	
			List<String> CellName = new ArrayList<String>();
			CellName.add("REQUEST_DT");
			CellName.add("CHG_REASON");
			CellName.add("ORD_CD");
			CellName.add("ORD_REG_DATE");
			CellName.add("ORDER_INFO");
			CellName.add("ORD_HP");
			CellName.add("SELLER_INFO");
			CellName.add("PROD_CODE");
			CellName.add("PROC_STAT_CD_NAME");
			CellName.add("PROD_NM");
			CellName.add("OPT_NM");
			CellName.add("PROD_PRICE");
			CellName.add("OPT_PRCE");
			CellName.add("ORD_QTY");
			CellName.add("PROD_PRCE");
			CellName.add("DLV_PRCE");
			CellName.add("CPN_USE_AMT");
			CellName.add("ORDER_PRICE");
			CellName.add("POINT_USE_AMT");
			CellName.add("REAL_SELT_AMT");
			CellName.add("SELT_GB_NAME");
			CellName.add("CARD_COMP_NM");
			CellName.add("RCV_NM");
			CellName.add("RCV_TEL");
			CellName.add("ZIP_CD");
			CellName.add("JUSO_JIBEN");
			CellName.add("JUSO_DORO");
			CellName.add("DLV_MSG");
			CellName.add("DLV_CMP_CD");
			CellName.add("INVC_NO");
			CellName.add("DLV_REGIST_DT");
			CellName.add("DLV_END_DT");
			
			List<String> sizeList = new ArrayList<String>();
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("30");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("50");
			sizeList.add("50");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
			sizeList.add("20");
	
			mav.addObject("fileName", "판매교환신청조회_"+today+".xls");
			mav.addObject("sizeList", sizeList);
			mav.addObject("SheetName", SheetName);
			mav.addObject("excelTitle", excelTitle);
			mav.addObject("CellName", CellName);
			
			mav.addObject("excelList", adminOrderService.selectListSaleOrdCancelExcel(inParam));
			mav.addObject("param", inParam);

		} catch (Exception e) {e.printStackTrace();}
		return mav;
	}


	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	@RequestMapping("/admin/order/procOrdCanlPopup.do")
	public ModelAndView procOrdCanlPopup(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("PROC ORDER CANCEL POPUP START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		try {
			mav.setViewName("admin/order/procOrdCanlPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
//	@RequestMapping("/admin/order/insertOrdCanl.do")
//	public ModelAndView insertOrdCanl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
//		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
//		logger.info("INSERT ORDER CANCEL POPUP START");
//		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
//		ModelAndView mav = new ModelAndView();
//		LoggerUtil.writeMap(inParam);
//		try {
//			System.out.println(inParam);
//			mav.setViewName("jsonView");
//		} catch (Exception e) {
//			e.printStackTrace();
//		}
//		return mav;
//	}
	
	/**
	 * <pre>
	 * 선택 주문 취소
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 24. 오후 2:01:14
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateOrdCncl.do")
	public ModelAndView updateOrdCncl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("UPDATE ORDER CANCEL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			mav.addObject("CNT", adminOrderService.updateOrdCncl(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	@RequestMapping("/admin/order/updateOrderDtl.do")
	public ModelAndView updateOrderDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT UPDATE DIV ORDER DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		String[] procStatCd = request.getParameterValues("L_PROC_STAT_CD");
		String[] prodCode = request.getParameterValues("L_PROD_CODE");
		String[] prodSeq = request.getParameterValues("L_PROD_SEQ");
		String[] updateYn = request.getParameterValues("L_UPDATE_YN");
		
		try {
			List<String> al = new ArrayList<String>();
			List<String> al1 = new ArrayList<String>();
			List<String> al2 = new ArrayList<String>();
			List<String> al3 = new ArrayList<String>();
			
		
			for (int i = 0; i < prodCode.length; i++) {
				System.out.println("###################@@"+updateYn[i].toString());

					al.add(prodCode[i].toString());
					al1.add(updateYn[i].toString());
					al2.add(procStatCd[i].toString());
					al3.add(prodSeq[i].toString());

			}
			inParam.put("L_PROD_CODE", al);
			inParam.put("L_UPDATE_YN", al1);
			inParam.put("L_PROC_STAT_CD", al2);
			inParam.put("L_PROD_SEQ", al3);

			System.out.println(inParam);
			mav.addObject("list", adminOrderService.updateOrderDtl(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	
	@RequestMapping("/admin/order/updateExcStat.do")
	public ModelAndView updateExcStat(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("UPDATE EXCHANGE ORDER START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		try {
			mav.addObject("list", adminOrderService.updateExcStat(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}

	
	
	
	/*==================================================================================================================================================*/
	
	/*==================================================================================================================================================*/
	//판매 주문 관리 KANG
	
	/**
	 * <pre>
	 * 판매 주문 내역 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 13. 오전 5:11:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListOrderSell.do")
	public ModelAndView selectListOrderSell(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception {
		
		logger.info("AdminOrderController.selectListOrderSell Start");
		LoggerUtil.writeMap(inParam);
		
		ModelAndView mav = new ModelAndView("admin/order/selectListOrderSell");
		
		String seltGbCd[] = request.getParameterValues("SELT_GB_CD[]");				// 결제수단
		String procStatCd[] = request.getParameterValues("PROC_STAT_CD[]");			// 주문상태
		
		// service 호출
		try {
			mav.addObject("list", adminOrderService.selectListOrderSell(inParam, seltGbCd, procStatCd));		
		} 
		catch (Exception e) {
			e.printStackTrace();
		}
		
		logger.info("AdminOrderController.selectListOrderSell End");
		
		return mav;
		
	}
	
	/*==================================================================================================================================================*/
	
	/*==================================================================================================================================================*/
	//나눔 주문 관리
	
	/**
	 * <pre>
	 * 나눔 내역 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 6. 오후 7:25:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListFreeShare.do")
	public ModelAndView selectListFreeShare(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectListFreeShare START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("admin/order/selectListFreeShare");
		LoggerUtil.writeMap(inParam);
		
		String procStatCd[] = request.getParameterValues("PROC_STAT_CD[]");
		
		// service 호출
		try {
			mav.addObject("list", adminOrderService.selectListFreeShare(inParam ,procStatCd));		
		} 
		catch (Exception e) {
			e.printStackTrace();
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectListFreeShare END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
	
	}
	
	/**
	 * <pre>
	 * 나눔 내역 엑셀다운로드
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 6. 오후 7:25:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListFreeShareExcel.do")
	public ModelAndView selectListFreeShareExcel(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception	{
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectListFreeShareExcel START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("excelDownloadView");
		LoggerUtil.writeMap(inParam);
		
		String procStatCd[] = request.getParameterValues("PROC_STAT_CD[]");
		
		// service 호출
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", "attachment; filename="
				+ new String(("freeShareList").getBytes("KSC5601"),"8859_1") +"_"+today+ ".xls");
			
			adminOrderService.selectListFreeShareExcel(mav, inParam ,procStatCd);		
		} 
		catch (Exception e) {
			e.printStackTrace();
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectListFreeShareExcel END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
	
	}
	
	/**
	 * <pre>
	 * 나눔 신청내역 상세조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 8. 오후 2:13:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectFreeShareReqDtl.do")
	public ModelAndView selectFreeShareDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception	{
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareReqDtl START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("admin/order/selectFreeShareReqDtl");
		LoggerUtil.writeMap(inParam);
		
		// service 호출
		try {
			mav.addObject("list", adminOrderService.selectFreeShareReqDtl(inParam));		
		} 
		catch (Exception e) {
			e.printStackTrace();
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareReqDtl END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
	
	}
	
	/**
	 * <pre>
	 * 나눔수락
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 9. 오후 2:30:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateFreeShareConfirm.do")
	public ModelAndView updateFreeConfirm(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareReqDtl START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("jsonView");
		
		// service 호출
		try {
			// 나눔수락
			adminOrderService.updateFreeShareConfirm(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			if ( mav.getModelMap().get("rtnMsg") == null || mav.getModelMap().get("rtnMsg").equals("")){
				mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
			} else {
				mav.addObject("rtnMsg", mav.getModelMap().get("rtnMsg"));
			}
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareReqDtl END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
		
	}
	
	/**
	 * <pre>
	 * 나눔내역 상세조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 9. 오후 3:39:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectFreeShareConfDtl.do")
	public ModelAndView selectFreeShareOrdDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception	{
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareOrdDtl START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("admin/order/selectFreeShareConfDtl");
		LoggerUtil.writeMap(inParam);
		
		// service 호출
		try {
			mav.addObject("result", adminOrderService.selectFreeShareConfDtl(inParam));		
		} 
		catch (Exception e) {
			e.printStackTrace();
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN selectFreeShareConfDtl END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
	
	}
	
	
	
	/**
	 * <pre>
	 * 배송지정보 변경
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 10. 오후 7:43:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateDlvInfo.do")
	public ModelAndView updateDlvInfo(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateDlvInfo START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("jsonView");
		
		// service 호출
		try {
			// 배송지정보 변경
			adminOrderService.updateDlvInfo(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateDlvInfo END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
		
	}
	
	/**
	 * <pre>
	 * 제휴택배 배송신청
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 12. 오전 10:57:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateFreeShareDlvReq.do")
	public ModelAndView updateFreeShareDlvReq(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateFreeShareDlvReq START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("jsonView");
		
		// service 호출
		try {
			// 제휴택배 배송신청
			adminOrderService.updateFreeShareDlvReq(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateFreeShareDlvReq END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
		
	}
	
	/**
	 * <pre>
	 * 일반택배, 우편/등기, 퀵서비스 상품배송
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 12. 오후 13:30:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateFreeShareProdDlv.do")
	public ModelAndView updateFreeShareProdDlv(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateFreeShareProdDlv START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("jsonView");
		
		// service 호출
		try {
			// 일반택배, 우편/등기, 퀵서비스 상품배송
			adminOrderService.updateFreeShareProdDlv(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateFreeShareProdDlv END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
		
	}
	
	/**
	 * <pre>
	 * 일반택배, 우편/등기, 퀵서비스 배송완료
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 10. 12. 오후 15:19:21
	 * @author Kang
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateDlvComplete.do")
	public ModelAndView updateDlvComplete(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateDlvComplete START☆★☆★☆★☆★☆★☆★☆");

		ModelAndView mav = new ModelAndView("jsonView");
		
		// service 호출
		try {
			// 일반택배, 우편/등기, 퀵서비스 배송완료
			adminOrderService.updateDlvComplete(mav, inParam);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			mav.addObject("rtnMsg", CmmnCnst.PROC_MSG_N);
		}
		
		logger.info("☆★☆★☆★☆★☆★☆★☆ADMIN updateDlvComplete END☆★☆★☆★☆★☆★☆★☆");
		
		return mav;
		
	}
	
	/*==================================================================================================================================================*/
	/**
	 * <pre>
	 * 주문 내역 조회
	 * 주문 내역 리스트를 조회합니다.
	 * @param request
	 * @param response
	 * @param inParam
	 * @param purcArray
	 * @param seltArray
	 * @param ordArray
	 * @return
	 * @throws Exception
	 * @date 2015. 8. 5. 오후 4:45:21
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListOrder.do")
	public ModelAndView selectListOrder(HttpServletRequest request, HttpServletResponse response
						, @RequestParam Map<String, Object> inParam
						, @RequestParam(value="S_PURC_GB", required=false) String[] purcArray
						, @RequestParam(value="S_SELT_GB", required=false) String[] seltArray
						, @RequestParam(value="S_ORD_GB", required=false) String[] ordArray) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT ORDER LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
//		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		
		try {
			inParam.put("PURC_GB_ARR", purcArray);
			inParam.put("SELT_GB_ARR", seltArray);
			inParam.put("ORD_GB_ARR", ordArray);
			mav.addObject("list", adminOrderService.selectListOrder(inParam));
			mav.setViewName("admin/order/selectListOrder");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 운송장 번호 등록
	 * 설명
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 17. 오후 3:09:18
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListDlv.do")
	public ModelAndView selectListDlv(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT DLV LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		
		try {
//			mav.addObject("list", adminOrderService.selectListDlv(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectOrderDlvPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 배송지 엑셀 파일 업로드
	 * 
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 28. 오후 1:31:23
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/excelFileUpload.do")
	public ModelAndView excelFileUpload(MultipartHttpServletRequest inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT INV EXCEL FILE UPLOAD START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			mav.addObject("list", adminOrderService.excelFileUpload(inParam));
//			mav.addObject("params", inParam);
			mav.setViewName("jsonView2");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	@RequestMapping("/admin/order/insertListDlv.do")
	public ModelAndView insertListDlv(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("INSERT DLV LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		try {
			mav.addObject("list", adminOrderService.insertListDlv(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("jsonView2");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 목록 엑셀 다운로드
	 * 주문 목록 조회 결과를 엑셀파일로 다운로드 한다.
	 * @param request
	 * @param response
	 * @param paramDto
	 * @return
	 * @date 2015. 7. 13. 오후 2:58:05
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectOrdListExcelDownload.do")
	public ModelAndView getOrdListExcelDownload(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) {
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT ORDER LIST EXCEL DOWNLOAD START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		mav.setViewName("excelDownloadView");
		
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		ModelMap mm = new ModelMap();
		
		try {
			String today = StringUtil.getCurrentDate();
			response.setContentType("application/msexcel");
			response.setHeader("Content-Disposition", "attachment; filename="
				+ new String(("orderList").getBytes("KSC5601"),"8859_1") +"_"+today+ ".xls");
			
			mm = adminOrderService.selectListOrdExcel(inParam);
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		String SheetName = "주문목록";
		
		List<String> excelTitle = new ArrayList<String>();
		excelTitle.add("주문일시");
		excelTitle.add("주문상태");
		excelTitle.add("주문번호");
		excelTitle.add("주문자ID");
		excelTitle.add("판매구분");
		excelTitle.add("상품명");
		excelTitle.add("결제수단");
		excelTitle.add("주문수량");
		excelTitle.add("상품금액");
		excelTitle.add("배송비");
		excelTitle.add("할인금액");
		excelTitle.add("최종결제금액");
		
		List<String> CellName = new ArrayList<String>();
		CellName.add("ORD_REG_DATE");
		CellName.add("ORD_STAT_CD");
		CellName.add("ORD_CD");
		CellName.add("ORD_EMAIL");
		CellName.add("PROD_TYPE_CD");
		CellName.add("PROD_NM");
		CellName.add("SELT_GB_CD");
		CellName.add("ORD_QTY");
		CellName.add("PROD_ORD_AMT");
		CellName.add("DLV_PRCE");
		CellName.add("DSCNT_AMT");
		CellName.add("ORD_AMT");
		
		mav.addObject("SheetName", SheetName);
		mav.addObject("excelTitle", excelTitle);
		mav.addObject("CellName", CellName);
		System.out.println(mm);
		mav.addObject("excelList", mm.get("selectListOrdExcel"));
		mav.addObject("param", inParam);
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문상세내용 조회
	 * 주문상세내용을 조회합니다.
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 14. 오후 2:25:44
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectOrderDtl.do")
	public ModelAndView selectOrderDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT ORDER DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		String mSeller = session.getSELLER_CD(); 
		String mVdrId  = session.getVDR_ID();
		String mAdmId = session.getADM_ID();
		try {
			inParam.put("M_SELLER_CD", mSeller);
			inParam.put("M_VDR_ID", mVdrId);
			inParam.put("SS_ADM_ID", mAdmId);
			mav.addObject("list", adminOrderService.selectOrderDtl(inParam));
			mav.setViewName("admin/order/selectOrderDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 상품 배송 처리
	 * 상품 배송 처리를 위한 택배사 조회
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 16. 오후 1:32:53
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/procOrderShipping.do")
	public ModelAndView procOrderShipping(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT PROC ORDER SHIPPING START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
//			mav.addObject("list", adminOrderService.selectListDlv(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectOrderShippingPopup");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 배송처리
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 29. 오후 4:11:43
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/insertOrderInv.do")
	public ModelAndView insertOrderInv(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("INSERT ORDER INV START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
			mav.addObject("list", adminOrderService.insertOrderShipping(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 교환/반품신청 조회
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 29. 오후 7:13:19
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListRfnd.do")
	public ModelAndView selectListFrnd(HttpServletRequest request, HttpServletResponse response
						, @RequestParam Map<String, Object> inParam
						, @RequestParam(value="S_PROD_GB", required=false) String[] prodArray
						, @RequestParam(value="S_PROC_GB", required=false) String[] procArray ) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT RFND LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
			inParam.put("PROD_GB_ARR", prodArray);
			inParam.put("PROC_GB_ARR", procArray);
			mav.addObject("list", adminOrderService.selectListRfnd(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectListRfnd");
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		return mav;
	}
	
	/**
	 * <pre>
	 * 교환/반품 상세 내역
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 7. 31. 오후 2:34:11
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectRfndDtl.do")
	public ModelAndView selectRfndDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT RFND DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);
		
		try {
			mav.addObject("list", adminOrderService.selectRfndDtl(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectRfndDtl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 교환/반품 상세정보 업데이트
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 8. 3. 오후 5:34:46
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/updateRfndDtl.do")
	public ModelAndView updateRfndDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("UPDATE RFND DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		
		try {
			inParam.put("ADM_ID", session.getADM_ID());
			mav.addObject("list", adminOrderService.updateRfndDtl(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 교환/반품 교환 완료 처리
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 8. 3. 오후 9:26:57
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/insertRfndDtl.do")
	public ModelAndView insertRfndDtl(HttpServletRequest request, HttpServletResponse response, @RequestParam Map<String, Object> inParam) throws Exception{
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("INSERT RFND DETAIL START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		AdminSession session = (AdminSession) request.getSession().getAttribute("manager");
		LoggerUtil.writeMap(inParam);
		
		try {
			inParam.put("ADM_ID", session.getADM_ID());
			mav.addObject("list", adminOrderService.insertRfndDtl(inParam));
			mav.setViewName("jsonView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}
	
	/**
	 * <pre>
	 * 주문 취소 조회
	 * 
	 * @param request
	 * @param response
	 * @param inParam
	 * @return
	 * @throws Exception
	 * @date 2015. 8. 4. 오후 11:44:48
	 * @author S.B.LEE
	 * @see com.ssocio.sharing.controller.admin
	 * </pre>
	 */
	@RequestMapping("/admin/order/selectListCncl.do")
	public ModelAndView selectListCncl(	HttpServletRequest request, HttpServletResponse response
						, @RequestParam Map<String, Object> inParam
						, @RequestParam(value = "S_PROD_GB", required = false) String[] prodArray) throws Exception {
		logger.info("☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★");
		logger.info("SELECT CNCL LIST START");
		logger.info("★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆★☆");
		ModelAndView mav = new ModelAndView();
		LoggerUtil.writeMap(inParam);

		try {
			inParam.put("PROD_GB_ARR", prodArray);
			mav.addObject("list", adminOrderService.selectListCncl(inParam));
			mav.addObject("params", inParam);
			mav.setViewName("admin/order/selectListCncl");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mav;
	}

	
	/**
	 * <pre>
	 * 엑셀 다운로드 브라우저 체크
	 * </pre>
	 */
	private String check_browser(HttpServletRequest request) {
		String browser = "";
		String header = request.getHeader("User-Agent");
		//신규추가된 indexof : Trident(IE11) 일반 MSIE로는 체크 안됨
		if (header.indexOf("MSIE") > -1 || header.indexOf("Trident") > -1){
		browser = "ie";
		}
		//크롬일 경우
		else if (header.indexOf("Chrome") > -1){
		browser = "chrome";
		}
		//오페라일경우
		else if (header.indexOf("Opera") > -1){
		browser = "opera";
		}
		//사파리일 경우
		else if (header.indexOf("Apple") > -1){
		browser = "sarari";
		} else {
		browser = "firfox"; 
		}
		return browser;
	}
	
	/**
	 * <pre>
	 * 엑셀 다운로드 파일명
	 * </pre>
	 */
	private String getDisposition(String down_filename, String browser_check) throws UnsupportedEncodingException {
		String prefix = "attachment;filename=";
		String encodedfilename = null;
		if (browser_check.equals("ie")) {
		encodedfilename = URLEncoder.encode(down_filename, "UTF-8").replaceAll("\\+", "%20");
		}else if (browser_check.equals("chrome")) {
		StringBuffer sb = new StringBuffer();
		for (int i = 0; i < down_filename.length(); i++){
		    char c = down_filename.charAt(i);
		    if (c > '~') {
		        sb.append(URLEncoder.encode("" + c, "UTF-8"));
		    } else {
		        sb.append(c);
		    }
		}
		encodedfilename = sb.toString();
		}else {
		encodedfilename = "\"" + new String(down_filename.getBytes("UTF-8"), "8859_1") + "\"";
		} 
		return prefix + encodedfilename;
	}
}
