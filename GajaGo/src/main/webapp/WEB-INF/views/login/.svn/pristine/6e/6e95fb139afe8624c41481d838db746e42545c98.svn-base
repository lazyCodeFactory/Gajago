<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/views/web/common/cmmnHead.jsp"%>
<style>
.title2 {height: 35px;line-height: 35px;background-color: #f1f1f1;padding: 0 10px;font-size: .88em;font-weight: bold;}
</style>
<script type="text/javascript" src="/js/web/cart.js" ></script> <!-- 장바구니용 js -->
<script type="text/javascript">

	var rtnMsg = '${rtnMsg}';
	var ordGb = '${params.ordGb}';

	//ready
	$(document).ready(function(){
		
		// title 및 back 버튼 url set
		var title = "";
		if (ordGb == "1") {
			title = "판매 주문내역 상세";
		}
		else if (ordGb == "2") {
			title = "판매 반품신청내역 상세";
		}
		else if (ordGb == "3") {
			title = "판매 주문취소내역 상세";
		}
		else if (ordGb == "4") {
			title = "판매 교환내역 상세";
		}
		document.title = title;
// 		header.type	= 6;
		header.type	= 4;
		header.title = title;
		header.method = "POST";
		header.backUrl = "/mobile/salemanage/selectListOrderSell.do";
		header.callback = headerCallback; // 장바구니용 callback
		header.form = $("#form");
		initHeader();
		
		displayFooter(false);
		
	});
	
	var page = {
			
		// 상태변경
		updateOrderSell : function (ordCd, prodSeq, prodCode, procStatCd) {
			
			var msg = "";
			if (procStatCd == "21") {msg = "선택하신 상품을 주문확인 처리"}
			if (procStatCd == "22") {msg = "선택하신 상품을 배송신청"}
			if (procStatCd == "23") {msg = "선택하신 상품을 배송완료 처리"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#upProcStatCd").val(procStatCd);

			$.ajax({
			    type: 'post'
			    , async: true
			    , dataType:'json'
			    , url: "/mobile/salemanage/updateOrderSellProcStat.do"
			    , data: $("#form").serialize()
			    , success: function(data) {
			    	
			    	alert(data.rtnMsg);
			    	
			    	$("#ordGb").val(data.params.ordGb);
			    	var url = "/mobile/salemanage/selectOrderSellDtl.do";
					form.action = url;
					form.submit();
			    	
			    }
			    , error: function(data, status, err) {
			      alert('서버와의 통신이 실패했습니다.');
			    }
			
			});
			
		},
		
		// 주문취소
		updateOrderSellCanc : function (ordCd, prodSeq, prodCode, procStatCd) {
			
			var msg = "";
			if (procStatCd == "50") {msg = "선택하신 상품을 주문취소"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#upProcStatCd").val(procStatCd);
			
			var url = "/mobile/salemanage/procOrderCanc.do";
			form.action = url;
			form.submit();
			
		},
		
		// 전체주문취소
		updateOrderSellCancAll : function (ordCd, procStatCd) {
			
			var msg = "";
			if (procStatCd == "50") {msg = "선택하신 상품을 주문취소"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#upProcStatCd").val(procStatCd);
			
			var url = "/mobile/salemanage/procOrderCanc.do";
			form.action = url;
			form.submit();
			
		},
		
		// 반품접수
		updateOrderSellBack : function (ordCd, prodCode, prodSeq, chgCd, procStatCd) {
			
			if (!confirm("반품접수 처리 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#chgCd").val(chgCd);
			$("#upProcStatCd").val(procStatCd);
			var url = "/mobile/salemanage/selectBackRequest.do";
			form.action = url;
			form.submit();
			
		},
		
		// 반품완료처리
		updateOrderSellRtn : function (ordCd, prodCode, prodSeq, chgCd, procStatCd) {
			
			var msg = "";
			if (procStatCd == "33") {msg = "선택하신 상품을 반품완료 처리"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#chgCd").val(chgCd);
			$("#upProcStatCd").val(procStatCd);
			
			$.ajax({
			    type: 'post'
			    , async: true
			    , dataType:'json'
			    , url: "/mobile/salemanage/updateOrderSellProcStat.do"
			    , data: $("#form").serialize()
			    , success: function(data) {
			    	
			    	alert(data.rtnMsg);
			    	
			    	$("#ordGb").val(data.params.ordGb);
			    	var url = "/mobile/salemanage/selectOrderSellDtl.do";
					form.action = url;
					form.submit();
			    	
			    }
			    , error: function(data, status, err) {
			      alert('서버와의 통신이 실패했습니다.');
			    }
			
			});
			
		},
		
		// 배송조회
		selectShipView : function (ordCd, prodCode, prodSeq) {
			$("#sOrdCd").val(ordCd);
			$("#sProdCode").val(prodCode);
			$("#sProdSeq").val(prodSeq);
			
			var url = "/mobile/buy/selectShipView.do";
			form.action = url;
			form.submit();
		},
		
		// 배송신청
		updateOrderSellDlv : function (ordCd, prodSeq, prodCode, procStatCd) {
			
			var msg = "";
			if (procStatCd == "22") {msg = "선택하신 상품을 배송신청"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#upProcStatCd").val(procStatCd);
			
			var url = "/mobile/salemanage/selectListGrpProdInfo.do";
			form.action = url;
			form.submit();
			
		},
		
		// 상품배송
		updateOrderDlvInvc : function (ordCd, prodSeq, prodCode, dlvWayCd, procStatCd) {
			
			var msg = "";
			if (procStatCd == "22") {msg = "선택하신 상품을 배송"}
			
			if (!confirm(msg+" 하시겠습니까?")) {
				return;
			}
			
			$("#ordCd").val(ordCd);
			$("#prodSeq").val(prodSeq);
			$("#prodCode").val(prodCode);
			$("#upProcStatCd").val(procStatCd);
			$("#dlvWayCd").val(dlvWayCd);
			
			var url = "";
			if (dlvWayCd != "2") {
				$.ajax({
				    type: 'post'
				    , async: true
				    , dataType:'json'
				    , url: "/mobile/salemanage/updateOrderSellProcStat.do"
				    , data: $("#form").serialize()
				    , success: function(data) {
				    	
				    	alert(data.rtnMsg);
				    	
				    	$("#ordGb").val(data.params.ordGb);
				    	var url = "/mobile/salemanage/selectOrderSellDtl.do";
						form.action = url;
						form.submit();
				    	
				    }
				    , error: function(data, status, err) {
				      alert('서버와의 통신이 실패했습니다.');
				    }
				
				});
				
			}
			else {
				url = "/mobile/salemanage/selectOrdDlvInfo.do";
				form.action = url;
				form.submit();
			}
			$("#reload").val("");
		},
		
		// 정산확인
		selectAdjustInfo : function (ordCd, prodCode, prodSeq, adjCompYn) {
			
			if (adjCompYn == "N") {
				alert("아직 정산 데이터가 확정되지 않았습니다. 익일 오전 9시 이후로 확인이 가능합니다.");
				return;
			}
			else {
				
				$.ajax({
				    type: 'post'
				    , async: true
				    , dataType:'json'
				    , url: "/mobile/salemanage/selectSellAdjustHist.do"
				    , data: {
				    	ordCd : ordCd
				       ,prodCode : prodCode
				       ,prodSeq : prodSeq
				    }
				    , success: function(data) {
				    	
				    	// 정산 조회 성공
				    	if (data.adjMap != null) {
				    		$("#prodImg").attr("alt", data.adjMap.PROD_IMG_URL);								// 상품이미지
				    		$("#adjProdNm").text(data.adjMap.PROD_NM);											// 상품명
				    		$("#ordQty").text(data.adjMap.ORD_QTY);												// 구매수량
				    		$("#confDate").text("구매확정 일시 : " + data.adjMap.CONF_DATE);						// 구매확정일시
				    		$("#prodPrce").text(numberWithCommas(data.adjMap.SELL_PRCE_SUM)+"원");				// 상품금액
				    		$("#optPrce").text(numberWithCommas(data.adjMap.OPT_PRCE_SUM)+"원");					// 옵션금액
				    		$("#dlvPrce").text(numberWithCommas(data.adjMap.DLV_PRCE)+"원");						// 배송비
				    		var cmtn = numberWithCommas(data.adjMap.CMTN)+"원<br/><span>("+data.adjMap.DNL_CMTN_RATE_NM+" 수수료 "+data.adjMap.DNL_CMTN_RATE+"% "+numberWithCommas(data.adjMap.DNL_CMTN)+"원 <br/>+ 결제수수료 "+numberWithCommas(data.adjMap.BILL_CMTN)+"원)</span>";
				    		$("#cmtn").html(cmtn);
				    		var dscnt = numberWithCommas(data.adjMap.DSCNT_CPN_AMT)+"원";
				    		if (data.adjMap.DSCNT_CPN_AMT > 0) {
				    			dscnt += "<br/><span>(쿠폰사용 분담율 "+data.adjMap.MARKET_BURDEN+"% "+numberWithCommas(data.adjMap.DSCNT_CPN_AMT)+"원)";
				    		}
				    		$("#dscnt").html(dscnt);
				    		$("#adjAmt").text(numberWithCommas(data.adjMap.ADJ_AMT)+"원");
				    		var adjStat = "";
				    		if (data.adjMap.ADJ_STAT == null || data.adjMap.ADJ_STAT == '') {
				    			adjStat += "정산대기중<br/><span>(입금예정일 : "+data.adjMap.ADJ_EXP_YMD+")";
				    			$("#adjStat").html(adjStat);
				    		}
				    		else {
				    			adjStat += "정산완료<br/><span>(정산완료일 : "+data.adjMap.CHG_YMD+")";
				    			$("#adjStat").html(adjStat);
				    		}
				    	}
				    	
				    	cdnreload();
				    	$('.public_stop').show();
						popup_show();
				    	
				    }
				    , error: function(data, status, err) {
				      alert('서버와의 통신이 실패했습니다.');
				    }
				
				});
				
			}
			
		},
		// 상품상세
		selectOrderProdDtl : function (prodCode) {

			location.href = '/mobile/prod/selectProd.do?PROD_CODE=' + prodCode;

		}
			
	};
	
</script>

<c:choose>
	<c:when test="${sessionScope.isPcAgent }">
	<!-- PC화면 -->
		<div class="roc">
			<ul class="inner">
				<li><img src="http://static.ssocio.net/pc/img/common/section/roc_home.png" alt="홈"></li>
				<li>판매관리</li>
			</ul>
		</div>
		<jsp:include page="../common/sale_top.jsp" flush="false" />
		<div class="mype_s_tit">
			<p>배송신청</p>
		</div>
	<!-- //PC화면 -->
	</c:when>
	<c:otherwise>
	<!-- 모바일 화면 -->
		<!-- container -->
		<div id="container">
	<!-- //모바일 화면 -->
	</c:otherwise>
</c:choose>

<form id="form" name="form" method="get" action="">
	<input type="hidden" id="ordGb" name="ordGb" value="${params.ordGb }" />
	<input type="hidden" id="ordCd" name="ordCd" value="" />
	<input type="hidden" id="prodSeq" name="prodSeq" value="" />
	<input type="hidden" id="prodCode" name="prodCode" value="" />
	<input type="hidden" id="prodCode" name="prodCode" value="" />
	<input type="hidden" id="upProcStatCd" name="upProcStatCd" value="" />
	<input type="hidden" id="dlvWayCd" name="dlvWayCd" value="" />
	<input type="hidden" id="chgCd" name="chgCd" value="" />
	<input type="hidden" id="dtlGb" name="dtlGb" value="Y" />
	<input type="hidden" id="prodTypeCd" name="prodTypeCd" value="1" />
	<input type="hidden" id="reload" name="reload" value="" />
	<input type="hidden" id="S_SCR_ID" name="S_SCR_ID" value="selectOrderSellDtl">
	<!-- 배송조회용 -->
	<input type="hidden" id="sOrdCd" name="S_ORD_CD" value="" />
	<input type="hidden" id="sProdCode" name="S_PROD_CD" value="" />
	<input type="hidden" id="sProdSeq" name="S_PROD_SEQ" value="" />
	<input type="hidden" id="scrGubun" name="S_SCR_GUBUN" value="" />

		<c:if test="${params.reload ne 'Y' }">
			<h3 class="title">
				<strong class="fl">${orderSellDtl.ORD_CD }</strong>
				<span class="fr">주문일 : ${orderSellDtl.REGIST_DT }</span>
			</h3>
	        <p class="title">
	        	주문상품 정보
<%-- 	        	<c:if test="${cacnYn == 'Y' }">
	        		<a href="javascript:page.updateOrderSellCancAll('${orderSellDtl.ORD_CD }','50');" class="btn_b right">
		        		전체주문취소
		        	</a>
	        	</c:if> --%>
	        </p>
	        <c:forEach var="subList" items="${orderSellDtl.subOrder }" varStatus="status">
	        	<c:choose>
	        		<c:when test="${params.ordGb == '1' }">
		        		<div class="sha_oder_area <c:if test="${status.index > 0 }">mt10</c:if>">
					        <ul class="sha_oder">
					        	<li>
				                	<ul class="mt10">
					                	<li>
					                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
					                		<img alt="${subList.PROD_IMG_URL }" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />">
					                		</a>
					                	</li>
					                	<li>
					                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
					                		<strong>${subList.PROD_NM }</strong>
					                		</a>
					                	</li>
					                	<li>
					                		<span>
					                			상품금액  <fmt:formatNumber value="${subList.SELL_PRCE }" type="number" />원
					                		</span>
					                	</li>
					                	<li>
					                		<span>
					                			<c:choose>
												  <c:when test="${subList.DLV_WAY_CD == '1' || subList.DLV_WAY_CD == '2'}" >
												  		<c:choose>
												  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
												  			택배 | 무료배송
												  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
												  			(
												  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
												  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
												  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
												  			)
												  			</c:if>
												  		</c:when>
		
												  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
												  			택배 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/<c:if test="${subList.DLV_PAY_F_CD eq '10'}">선불</c:if><c:if test="${subList.DLV_PAY_F_CD eq '20'}">착불</c:if>
												  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
												  				(
												  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
												  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
												  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
												  				)
												  			</c:if>
												  		</c:when>
												  		</c:choose>
												  </c:when>
												  <c:when test="${subList.DLV_WAY_CD == '3' }" >
												  	우편/등기 | 무료배송
												  </c:when>
		
												  <c:when test="${subList.DLV_WAY_CD == '4' }" >
												  	<c:choose>
		
												  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
												  			퀵서비스 | 무료배송
												  		</c:when>
		
												  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
												  			퀵서비스 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/착불
												  		</c:when>
												  	</c:choose>
												  </c:when>
												  <c:when test="${subList.DLV_WAY_CD == '5' }" >
												  	직거래
												  </c:when>
												</c:choose> |  구매수량 <fmt:formatNumber value="${subList.ORD_QTY}" pattern="#,###" />개
						                	</span>
					                	</li>
					                </ul>
					                
					                <c:forEach var="optList" items="${subList.subOrderOpt }">
				                  	    <div class="opt_area">
				                  	    	<c:choose>
				                  	    		<c:when test="${optList.OP_GB_CD == '10' }">
				                  	    			<p>${optList.OPT_INFO}(+<fmt:formatNumber value="${optList.OPT_PRCE}" pattern="#,###" />원) </p>
						                			<span><fmt:formatNumber value="${optList.OPT_QTY}" pattern="#,###" />개</span>
				                  	    		</c:when>
				                  	    		<c:otherwise>
				                  	    			<p>[추가상품] ${optList.OPT_INFO}(<fmt:formatNumber value="${optList.OPT_PRCE}" pattern="#,###" />원) </p>
						                			<span><fmt:formatNumber value="${optList.OPT_QTY}" pattern="#,###" />개</span>
				                  	    		</c:otherwise>
				                  	    	</c:choose> 
					                	</div>
				                	</c:forEach>
						            
						            
									<p class="btn">
										<span class="fl">
											<c:choose>
												<c:when test="${subList.PROC_STAT_CD == '10' }">
													<a href="javascript:page.updateOrderSell('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','21');" class="btn_b">주문확인</a>
													<!--<a href="javascript:f_goCommCall('/mobile/buy/selectSaleOrderCancel.do', '${orderSellDtl.ORD_CD}', '${subList.PROD_CODE}', '${subList.PROD_SEQ}', 'orderCancel');" class="btn_b-line">주문취소</a>  -->
													<a href="javascript:page.updateOrderSellCanc('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','50');" class="btn_b">주문취소</a>
												</c:when>
												<c:when test="${subList.PROC_STAT_CD == '21' }">
													<c:choose>
														<c:when test="${subList.DLV_WAY_CD == '1' }">
															<a href="javascript:page.updateOrderSellDlv('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','22');" class="btn_b">배송신청</a>
														</c:when>
														<c:when test="${subList.DLV_WAY_CD == '2' or subList.DLV_WAY_CD == '3' or subList.DLV_WAY_CD == '4'  }">
															<a href="javascript:page.updateOrderDlvInvc('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','${subList.DLV_WAY_CD }','22');" class="btn_b">상품배송</a>
														</c:when>
													</c:choose>
													
														<!--<a href="javascript:f_goCommCall('/mobile/buy/selectSaleOrderCancel.do', '${orderSellDtl.ORD_CD}', '${subList.PROD_CODE}', '${subList.PROD_SEQ}', 'orderCancel');" class="btn_b-line">주문취소</a>  -->
														<a href="javascript:page.updateOrderSellCanc('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','50');" class="btn_b">주문취소</a>
													
												</c:when>
												<c:when test="${subList.PROC_STAT_CD == '22' }">
													<c:choose>
														<c:when test="${subList.DLV_WAY_CD == '1' }">
															<a href="javascript:page.selectShipView('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }');" class="btn_b">배송조회</a>
														</c:when>
														<c:when test="${subList.DLV_WAY_CD == '2' }">
															<!--<a href="javascript:page.updateOrderSell('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','23');" class="btn_b">배송완료</a>  -->
															<a href="javascript:page.selectShipView('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }');" class="btn_b">배송조회</a>
														</c:when>
														<c:when test="${subList.DLV_WAY_CD == '3' or subList.DLV_WAY_CD == '4' }">
															<!-- <a href="javascript:page.updateOrderSell('${orderSellDtl.ORD_CD }','${subList.PROD_SEQ }','${subList.PROD_CODE }','23');" class="btn_b">배송완료</a> -->
														</c:when>
													</c:choose>
												</c:when>
												<c:when test="${subList.PROC_STAT_CD == '99' }">
													<!-- <a href="javascript:page.selectAdjustInfo('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }','${subList.ADJ_COMP_YN }');" class="btn_b">정산확인</a> -->
												</c:when>
											</c:choose>
										</span>
										<span class="fr">
											<strong>${subList.PROC_STAT_CD_NM }</strong>
										</span>
									</p>
					            </li>
					        </ul>
						</div>
	        		</c:when>
	        		<c:when test="${params.ordGb == '2' }">
	        			<ul class="sha_oder <c:if test="${status.index > 0 }">mt10</c:if>">
				        	<li>
			                	<ul class="mt10">
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                		<img alt="${subList.PROD_IMG_URL }" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />">
				                		</a>
				                	</li>
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                		<strong>${subList.PROD_NM }</strong>
				                		</a>
				                	</li>
				                	<li>
				                		<span>
				                			상품금액  <fmt:formatNumber value="${subList.SELL_PRCE }" type="number" />원
				                		</span>
				                	</li>
				                	<li>
				                		<span>
				                			<c:choose>
											  <c:when test="${subList.DLV_WAY_CD == '1' || subList.DLV_WAY_CD == '2'}" >
											  		<c:choose>
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			택배 | 무료배송
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  			(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  			)
											  			</c:if>
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			택배 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/<c:if test="${subList.DLV_PAY_F_CD eq '10'}">선불</c:if><c:if test="${subList.DLV_PAY_F_CD eq '20'}">착불</c:if>
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  				(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  				)
											  			</c:if>
											  		</c:when>
											  		</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '3' }" >
											  	우편/등기 | 무료배송
											  </c:when>
	
											  <c:when test="${subList.DLV_WAY_CD == '4' }" >
											  	<c:choose>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			퀵서비스 | 무료배송
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			퀵서비스 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/착불
											  		</c:when>
											  	</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '5' }" >
											  	직거래
											  </c:when>
											</c:choose> |  구매수량 <fmt:formatNumber value="${subList.ORD_QTY}" pattern="#,###" />개
					                	</span>
				                	</li>
				                </ul>
								<p class="btn">
									<span class="fl">
										<c:choose>
											<c:when test="${subList.PROC_STAT_CD == '31' }">
												<a href="javascript:page.updateOrderSellBack('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }','${subList.CHG_CD }','32');" class="btn_b">반품처리</a>						
											</c:when>
											<c:when test="${subList.PROC_STAT_CD == '32' }">
												<a href="javascript:page.updateOrderSellRtn('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }','${subList.CHG_CD }','33');" class="btn_b">반품완료</a>
											</c:when>
										</c:choose>
									</span>
									<span class="fr">
										<strong>${subList.PROC_STAT_CD_NM }</strong>
									</span>
								</p>
				            </li>
				        </ul>
				        <p class="title">반품 신청 정보</p>
				        <div class="tbl">
				            <table class="tbl-data">
				                <colgroup>
				                    <col width="100px">
				                    <col width="*">
				                </colgroup>
				                <tbody>
				                    <tr>
				                        <th>신청일시</th>
				                        <td>
				                        	${subList.CHG_REG_DT }
				                        </td>
				                    </tr>
				                    <tr>
				                        <th>반품사유</th>
				                        <td>
				                        	${subList.CHG_REASON_CD_NM } | ${subList.CHG_REASON }
				                        </td>
				                    </tr>
				                </tbody>
				            </table>
				        </div>
	        		</c:when>
	        		<c:when test="${params.ordGb == '3' }">
				        <ul class="sha_oder <c:if test="${status.index > 0 }">mt10</c:if>">
				        	<li>
			                	<ul class="mt10">
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                			<img alt="${subList.PROD_IMG_URL }" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />">
				                		</a>
				                	</li>
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                			<strong>${subList.PROD_NM }</strong>
				                		</a>
				                	</li>
				                	<li>
				                		<span>
				                			상품금액  <fmt:formatNumber value="${subList.SELL_PRCE }" type="number" />원
				                		</span>
				                	</li>
				                	<li>
				                		<span>
				                			<c:choose>
											  <c:when test="${subList.DLV_WAY_CD == '1' || subList.DLV_WAY_CD == '2'}" >
											  		<c:choose>
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			택배 | 무료배송
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  			(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  			)
											  			</c:if>
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			택배 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/<c:if test="${subList.DLV_PAY_F_CD eq '10'}">선불</c:if><c:if test="${subList.DLV_PAY_F_CD eq '20'}">착불</c:if>
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  				(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  				)
											  			</c:if>
											  		</c:when>
											  		</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '3' }" >
											  	우편/등기 | 무료배송
											  </c:when>
	
											  <c:when test="${subList.DLV_WAY_CD == '4' }" >
											  	<c:choose>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			퀵서비스 | 무료배송
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			퀵서비스 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/착불
											  		</c:when>
											  	</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '5' }" >
											  	직거래
											  </c:when>
											</c:choose> |  구매수량 <fmt:formatNumber value="${subList.ORD_QTY}" pattern="#,###" />개
					                	</span>
				                	</li>
				                </ul>
								<p class="btn">
									<span class="fl">
										
									</span>
									<span class="fr">
										<strong>${subList.PROC_STAT_CD_NM }</strong>
									</span>
								</p>
				            </li>
				        </ul>
				        <p class="title">주문취소 신청 정보</p>
				        <div class="tbl">
				            <table class="tbl-data">
				                <colgroup>
				                    <col width="100px">
				                    <col width="*">
				                </colgroup>
				                <tbody>
				                    <tr>
				                        <th>신청일시</th>
				                        <td>
				                        	${subList.CANC_DT }
				                        </td>
				                    </tr>
				                    <tr>
				                        <th>취소사유</th>
				                        <td>
				                        	${subList.CANC_REASON_CD_NM } | ${subList.CANC_REASON }
			                        		
				                        </td>
				                    </tr>
				                </tbody>
				            </table>
				        </div>
	        		</c:when>
	        		<c:when test="${params.ordGb == '4' }">
	        			<ul class="sha_oder <c:if test="${status.index > 0 }">mt10</c:if>">
				        	<li>
			                	<ul class="mt10">
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                			<img alt="${subList.PROD_IMG_URL }" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />">
				                		</a>
				                	</li>
				                	<li>
				                		<a href="javascript:page.selectOrderProdDtl('${subList.PROD_CODE }');">
				                			<strong>${subList.PROD_NM }</strong>
				                		</a>
				                	</li>
				                	<li>
				                		<span>
				                			상품금액  <fmt:formatNumber value="${subList.SELL_PRCE }" type="number" />원
				                		</span>
				                	</li>
				                	<li>
				                		<span>
				                			<c:choose>
											  <c:when test="${subList.DLV_WAY_CD == '1' || subList.DLV_WAY_CD == '2'}" >
											  		<c:choose>
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			택배 | 무료배송
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  			(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  			)
											  			</c:if>
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			택배 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/<c:if test="${subList.DLV_PAY_F_CD eq '10'}">선불</c:if><c:if test="${subList.DLV_PAY_F_CD eq '20'}">착불</c:if>
											  			<c:if test="${subList.DLV_GROUP_YN eq 'Y' ||  subList.DLV_STAND_AMT > 0}">
											  				(
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' }">묶음배송</c:if>
											  				<c:if test="${subList.DLV_GROUP_YN eq 'Y' &&  subList.DLV_STAND_AMT > 0}">,</c:if>
											  				<c:if test="${subList.DLV_STAND_AMT > 0 }"><fmt:formatNumber value="${subList.DLV_STAND_AMT}" pattern="#,###" />원 이상 무료</c:if>
											  				)
											  			</c:if>
											  		</c:when>
											  		</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '3' }" >
											  	우편/등기 | 무료배송
											  </c:when>
	
											  <c:when test="${subList.DLV_WAY_CD == '4' }" >
											  	<c:choose>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '1' }" >
											  			퀵서비스 | 무료배송
											  		</c:when>
	
											  		<c:when test="${subList.DLV_PAY_GB_CD == '2' }" >
											  			퀵서비스 | <fmt:formatNumber value="${subList.DLV_PRCE}" pattern="#,###" />원/착불
											  		</c:when>
											  	</c:choose>
											  </c:when>
											  <c:when test="${subList.DLV_WAY_CD == '5' }" >
											  	직거래
											  </c:when>
											</c:choose> |  구매수량 <fmt:formatNumber value="${subList.ORD_QTY}" pattern="#,###" />개
					                	</span>
				                	</li>
				                </ul>
								<p class="btn">
									<%-- <span class="fl">
										<c:choose>
											<c:when test="${subList.PROC_STAT_CD == '41' }">
												<a href="javascript:page.updateOrderSellBack('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }','${subList.CHG_CD }','43');" class="btn_b">교환처리중</a>						
											</c:when>
											<c:when test="${subList.PROC_STAT_CD == '32' }">
												<a href="javascript:page.updateOrderSellRtn('${orderSellDtl.ORD_CD }','${subList.PROD_CODE }','${subList.PROD_SEQ }','${subList.CHG_CD }','42');" class="btn_b">교환완료</a>
											</c:when>
										</c:choose>
									</span> --%>
									<span class="fr">
										<strong>${subList.PROC_STAT_CD_NM }</strong>
									</span>
								</p>
				            </li>
				        </ul>
				        <p class="title">교환 신청 정보</p>
				        <div class="tbl">
				            <table class="tbl-data">
				                <colgroup>
				                    <col width="100px">
				                    <col width="*">
				                </colgroup>
				                <tbody>
				                    <tr>
				                        <th>신청일시</th>
				                        <td>
				                        	${subList.CHG_REG_DT }
				                        </td>
				                    </tr>
				                    <tr>
				                        <th>반품사유</th>
				                        <td>
				                        	${subList.CHG_REASON_CD_NM } | ${subList.CHG_REASON }
				                        </td>
				                    </tr>
				                </tbody>
				            </table>
				        </div>
	        		</c:when>
	        	</c:choose>
			</c:forEach>
	        
			<p class="title">구매자 정보 
				<c:choose>
               		<c:when test="${orderSellDtl.SECU_NO_USE_YN != null and orderSellDtl.SECU_NO_USE_YN == 'Y' }">
               			<a href="TEL:${orderSellDtl.SECU_NO }" class="user_phone">
			        		<strong>전화걸기</strong>
			        	</a>
               		</c:when>
               		<c:otherwise>
               			<c:choose>
                 		<c:when test="${orderSellDtl.RCV_HP != null and orderSellDtl.RCV_HP != '' }">
                 			<a href="TEL:${orderSellDtl.ORD_HP }" class="user_phone">
				        		<strong>전화걸기</strong>
				        	</a>
                 		</c:when>
                 		<c:otherwise>
                 			<a href="TEL:${orderSellDtl.ORD_TEL }" class="user_phone">
				        		<strong>전화걸기</strong>
				        	</a>
                 		</c:otherwise>
                 	</c:choose>
               		</c:otherwise>
               	</c:choose>
	        	
			</p>
			<div class="user_info">
	        	<span class="fl">
	        		<img alt="${orderSellDtl.MBER_IMG_URL }" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />" />
	        	</span>
	        	<p class="fl ml5">
	        		<span><img src="${orderSellDtl.MBER_LEV }" class="img_level"/>${orderSellDtl.ORD_EMAIL }</span>
	        	</p>

			</div>
			
			<c:if test="${params.ordGb == '1' }">
				<p class="title">배송지 정보</p>
		        <div class="tbl">
		            <table class="tbl-data">
		                <colgroup>
		                    <col width="100px">
		                    <col width="*">
		                </colgroup>
		                <tbody>
		                    <tr>
		                        <th>받는사람</th>
		                        <td>${orderSellDtl.RCV_NM }</td>
		                    </tr>
		                    <tr>
		                        <th>주소</th>
		                        <td>
		                        	<c:set var="dlvAddr" value="" />
		                        	<c:set var="dlvAddrSplt" value="${fn:split(orderSellDtl.JUSO_JIBEN, ' ') }" />
		                        	<c:forEach var="addr" items="${dlvAddrSplt }" varStatus="status">
		                        		<c:if test="${status.last }">
		                        			<c:set var="dlvAddr" value="${addr }" />
		                        		</c:if>
		                        	</c:forEach>
		                        	${orderSellDtl.JUSO_DORO } (${dlvAddr }) ${orderSellDtl.JUSO_DTL }
		                        </td>
		                    </tr>
		                    <tr>
		                        <th>연락처</th>
		                        <td>
		                        	<c:choose>
		                        		<c:when test="${orderSellDtl.SECU_NO_USE_YN != null and orderSellDtl.SECU_NO_USE_YN == 'Y' }">
		                        			${orderSellDtl.SECU_NO } (안심번호 사용)
		                        		</c:when>
		                        		<c:otherwise>
		                        			<c:choose>
				                        		<c:when test="${orderSellDtl.RCV_HP != null and orderSellDtl.RCV_HP != '' }">
				                        			${orderSellDtl.RCV_HP }
				                        		</c:when>
				                        		<c:otherwise>
				                        			${orderSellDtl.RCV_TEL }
				                        		</c:otherwise>
				                        	</c:choose>
		                        		</c:otherwise>
		                        	</c:choose>
		                        </td>
		                    </tr>
		                    <tr>
		                        <th>배송메모</th>
		                        <td>
		                        	${orderSellDtl.DLV_MSG }
		                        </td>
		                    </tr>
		                </tbody>
		            </table>
		        </div>
		        
		        <p class="title">주문정보</p>
		        <table class="tbl-order">
		            <colgroup>
		                <col width="33.3%">
		                <col width="33.3%">
		                <col width="*">
		            </colgroup>
		            <thead>
		                <tr>
		                    <th>주문금액</th>
		                    <th>할인금액</th>
		                    <th>결제금액</th>
		                </tr>
		            </thead>
		            <tbody>
		                <tr>
		                    <td><fmt:formatNumber value="${orderAmtMap.BF_ORD_AMT }" type="number" />원</td>
		                    <td><fmt:formatNumber value="${orderAmtMap.CPN_USE_AMT+ orderAmtMap.POINT_USE_AMT }" type="number" />원</td>
		                    <td><strong class="point_r"><fmt:formatNumber value="${orderAmtMap.SELT_AMT }" type="number" />원</strong></td>
		                </tr>
		            </tbody>
		        </table>
		
		        <p class="order_arrow"><img src="http://static.ssocio.net/web/images/order_arrow.png" alt=""></p>
		        <div class="tbl inner">
		            <table class="tbl-data">
		                <colgroup>
		                    <col width="100px">
		                    <col width="*">
		                </colgroup>
		                <tbody>
		                	<tr class="line">
		                        <td colspan="2"><strong>주문금액</strong></td>
		                    </tr>
		                    <tr>
		                        <th>상품금액</th>
		                        <td class="tr"><strong><fmt:formatNumber value="${orderAmtMap.DSCNT_BF_ORD_AMT }" type="number" />원</strong></td>
		                    </tr>
		                    <tr>
		                        <th>배송비</th>
		                        <td class="tr"><strong><fmt:formatNumber value="${orderAmtMap.DLV_SELT_AMT }" type="number" />원</strong></td>
		                    </tr>
		                    
		                </tbody>
		            </table>
		        </div>
		
		        <div class="tbl inner">
		            <table class="tbl-data">
		                <colgroup>
		                    <col width="100px">
		                    <col width="*">
		                </colgroup>
		                <tbody>
		                    <tr class="line">
		                        <td colspan="2"><strong>할인금액</strong></td>
		                    </tr>
		                    <tr>
		                        <th>쿠폰할인</th>
		                        <td class="tr"><strong><fmt:formatNumber value="${orderAmtMap.CPN_USE_AMT }" type="number" />원</strong></td>
		                    </tr>
		                   
		                    <tr>
		                        <th>포인트</th>
		                        <td class="tr"><strong><fmt:formatNumber value="${orderAmtMap.POINT_USE_AMT }" type="number" />P</strong></td>
		                    </tr>
		                    <!--
		                    <tr>
		                        <td colspan="2" class="tr"><span>(첫구매쿠폰 3,000원 + 즉시할인쿠폰 2,000원<br/>유입경로할인 5,000원)</span></td>
		                    </tr>
		                    -->
		                </tbody>
		            </table>
		        </div>
		
		         <div class="tbl inner mb10">
		           <table class="tbl-data">
		                <colgroup>
		                    <col width="100px">
		                    <col width="*">
		                </colgroup>
		                <tbody>
		                    <tr class="line">
		                        <th>결제금액</th>
		                        <td class="tr"><strong class="point_r"><fmt:formatNumber value="${orderAmtMap.SELT_AMT }" type="number" />원</strong>
		                        <br><span>${SELT_GB_NM}</span></td>
		                    </tr>
		                </tbody>
		            </table>
		        </div>
	        </c:if>
	        
		</c:if>


	<!-- 정산확인 팝업 -->
	<div class="popup public_stop" style="display:none;">
		<p class="title">
			<strong>정산확인</strong>
			<a href="#" class="btn_close">
				<img src="http://static.ssocio.net/web/images/btn_layer_close.png" alt="닫기" />
			</a>
		</p>
		<ul class="sha_oder">
			<li>
				<ul class="mt10">
					<li><img id="prodImg" src="<custom:codeTag code="DEFAULT_IMG_URL" groupCode="SITE_DEFAULT" />" alt=""></li>
					<li><strong id="adjProdNm"></strong></li>
					<li><span>구매수량 <span id="ordQty"></span>개</span></li>
				</ul>
			</li>
		</ul>
		<p class="pop_title2" id="confDate"></p>
		<div class="tbl">
			<table class="tbl-data">
				<colgroup>
					<col width="20%;">
					<col width="*">
				</colgroup>
				<tbody>
					<tr>
						<th>상품금액</th>
						<td class="tr" id="prodPrce"></td>
					</tr>
					<tr>
						<th>옵션금액</th>
						<td class="tr" id="optPrce">0원</td>
					</tr>
					<tr>
						<th>배송비</th>
						<td class="tr" id="dlvPrce"></td>
					</tr>
					<tr>
						<th>수수료</th>
						<td class="tr" id="cmtn"></td>
					</tr>
					<tr>
						<th>할인공제</th>
						<td class="tr" id="dscnt"></td>
					</tr>
					<tr class="text_r">
						<th>정산금액</th>
						<td class="tr" id="adjAmt"></td>
					</tr>
					<tr>
						<th>정산상태</th>
						<td class="tr" id="adjStat">정산대기중<br/><span>(입금예정일 : 2015.05.30)</span></td>
					</tr>
				</tbody>
			</table>
			<ul class="lst_info">
				<li><span>※ 정산금액 = 보증금 + 배송비 - 수수료 - 할인공제</span></li>
				<li><span>※ 정산금액은 영업일 기준 3일 후 등록 된 계좌로 입금됩니다.</span></li>
				<li><span>※ 할인공제금액은 구매자가 상품구매시 사용한 쿠폰 할인금액에 대해 다날쏘시오와 판매자간 분담율에 따라 책정됩니다.</span></li>
			</ul>
		</div>
		<div class="bot_btn">
			<a href="javascript:popup_hide();" class="btn_r">확인</a>
		</div>
	</div>
	<!-- //정산확인 팝업-->
</form>

<c:choose>
	<c:when test="${sessionScope.isPcAgent }">
	<!-- PC화면 -->
		<jsp:include page="../common/sale_bottom.jsp" flush="false" />
	<!-- //PC화면 -->
	</c:when>
	<c:otherwise>
	<!-- 모바일 화면 -->
		    </div>
		    <!-- //container -->
	<!-- //모바일 화면 -->
	</c:otherwise>
</c:choose>
